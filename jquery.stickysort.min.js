!function(t){t.fn.stickySort=function(e){var s=t.extend(!0,{threshold:{rows:3,viewport:.25,px:!1,allowanceEval:"min"},sortable:!1,scrollThrottle:15,resizeThrottle:250,vOffset:0},e);return this.each(function(){if(t(this).is("table")&&t(this).find("thead").length>0&&t(this).find("th").length>0){var e=t(window),a=t(this),i=a.find("thead").clone(),o=a.find("thead, tbody").clone();a.wrap('<div class="sticky-wrap" />').parent().addClass(a.attr("class")).end().addClass("sticky-enabled"),a.hasClass("overflow-y")&&a.removeClass("overflow-y").parent().addClass("overflow-y"),a.after('<div class="sticky-thead"><table /></div>'),a.find("tbody th").length>0&&a.after('<div class="sticky-col"><table /></div><div class="sticky-intersect"><table /></div>');var d=t(this).siblings(".sticky-thead"),r=t(this).siblings(".sticky-col"),n=t(this).siblings(".sticky-intersect"),l=t(this).parent(".sticky-wrap");d.find("table").append(i),r.find("table").append(o).find("thead th:gt(0)").remove().end().find("tbody td").remove(),n.find("table").html("<thead><tr><th>"+a.find("thead th:first-child").html()+"</th></tr></thead>");var h=function(){a.find("thead th").each(function(e){d.find("th").eq(e).width(t(this).width())}).end().find("tr").each(function(e){r.find("tr").eq(e).height(t(this).height())}),d.width(l.width()).find("table").width(a.width()),r.find("th").add(n.find("th")).width(a.find("thead th").first().width()),r.find("table").css({left:l.offset().left})},f=function(){var i=c();a.height()>l.height()?l.scrollTop()>0?(d.add(n).css({opacity:1,"pointer-events":"auto",position:"fixed",top:l.offset().top-e.scrollTop(),left:l.offset().left}),d.find("table").css({left:-l.scrollLeft()})):(d.add(n).css({opacity:0,"pointer-events":"none"}),n.css({position:"absolute",top:0,left:0})):e.scrollTop()>a.offset().top-s.vOffset&&e.scrollTop()<a.offset().top+a.outerHeight()-i?(d.add(n).css({opacity:1,"pointer-events":"auto",position:"fixed",left:l.offset().left-t(window).scrollLeft(),top:s.vOffset}),d.find("table").css({left:-l.scrollLeft()})):d.add(n).css({opacity:0,"pointer-events":"none",position:"absolute",left:0}),l.scrollLeft()>0?r.css({position:"fixed",left:l.offset().left-t(window).scrollLeft(),top:l.offset().top-e.scrollTop(),height:l.height()}).find("table").css({top:-l.scrollTop(),left:0}).end().add(n).css({opacity:1,"pointer-events":"auto"}):r.css({opacity:0,"pointer-events":"none"})},c=function(){var i=0,o=[];return a.find("tbody tr:lt("+s.threshold.rows+")").each(function(){i+=t(this).height()}),o.push(i),o.push(e.height()*s.threshold.viewport),s.threshold.px&&o.push(s.threshold.px),"min"==s.threshold.allowanceEval?Math.min.apply(null,o):Math.max.apply(null,o)};h(),a.parent(".sticky-wrap").scroll(t.throttle(s.scrollThrottle,f)),e.load(h).resize(t.debounce(s.resizeThrottle,function(){h(),f()})).scroll(t.throttle(s.scrollThrottle,f)),(s.sortable||void 0!=a.data("sortable")||a.hasClass("sortable"))&&(a.find("tbody tr").each(function(e){t(this).attr("data-sortOrder",e)}),l.addClass("sortable").find("thead th").addClass("sort-default").data("sortState",1).wrapInner("<div />").find("div").css({position:"relative"}).append('<a href="#" class="sort-handle"></a>').find(".sort-handle").click(function(t){t.preventDefault()}),l.on("click",".sticky-enabled thead th, .sticky-thead thead th, .sticky-col thead th, .sticky-intersect thead th",function(){var e=t(this),s=e.index(),i=l.find("thead th").eq(s),o=t.makeArray(a.find("tbody tr"));e.data("sortState")%3==0?(o.sort(function(e,s){return parseInt(t(e).attr("data-sortOrder"))-parseInt(t(s).attr("data-sortOrder"))}),e.add(i).removeClass().addClass("sort-default")):(o.sort(function(e,a){function i(t){for(var e,s,a=[],i=0,o=-1,d=0;e=(s=t.charAt(i++)).charCodeAt(0);){var r=46==e||e>=48&&57>=e;r!==d&&(a[++o]="",d=r),a[o]+=s}return a}var o=i(t(e).children().eq(s).text()),d=i(t(a).children().eq(s).text());for(x=0;o[x]&&d[x];x++)if(o[x]!==d[x]){var r=Number(o[x]),n=Number(d[x]);return r==o[x]&&n==d[x]?r-n:o[x]>d[x]?1:-1}return o.length-d.length}),e.data("sortState")%3==2?(o=o.reverse(),e.add(i).removeClass().addClass("sort-desc")):e.add(i).removeClass().addClass("sort-asc"));var d=e.data("sortState")+1;e.add(i).data("sortState",d%3),l.find("table").each(function(e){t(this).find("thead th").not(":eq("+s+")").data("sortState",1).removeClass().addClass("sort-default")}),a.find("tbody").html(o),a.find("tbody tr").each(function(e){r.find("tbody tr").eq(e).find("th").html(t(this).find("th").first().html())})}))}}),this}}(jQuery);
