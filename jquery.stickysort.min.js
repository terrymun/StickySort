!function(t){t.fn.stickySort=function(e){var s=t.extend(!0,{threshold:{rows:3,viewport:.25,px:!1,allowanceEval:"min"},sortable:!1,scrollThrottle:15,resizeThrottle:250},e);return this.each(function(){if(t(this).is("table")&&t(this).find("thead").length>0&&t(this).find("th").length>0){var e=t(window),a=t(this),i=a.find("thead").clone(),d=a.find("thead, tbody").clone();a.wrap('<div class="sticky-wrap" />').parent().addClass(a.attr("class")).end().addClass("sticky-enabled"),a.hasClass("overflow-y")&&a.removeClass("overflow-y").parent().addClass("overflow-y"),a.after('<div class="sticky-thead"><table /></div>'),a.find("tbody th").length>0&&a.after('<div class="sticky-col"><table /></div><div class="sticky-intersect"><table /></div>');var o=t(this).siblings(".sticky-thead"),n=t(this).siblings(".sticky-col"),r=t(this).siblings(".sticky-intersect"),l=t(this).parent(".sticky-wrap");o.find("table").append(i),n.find("table").append(d).find("thead th:gt(0)").remove().end().find("tbody td").remove(),r.find("table").html("<thead><tr><th>"+a.find("thead th:first-child").html()+"</th></tr></thead>");var h=function(){a.find("thead th").each(function(e){o.find("th").eq(e).width(t(this).width())}).end().find("tr").each(function(e){n.find("tr").eq(e).height(t(this).height())}),o.width(l.width()).find("table").width(a.width()),n.find("th").add(r.find("th")).width(a.find("thead th").first().width()),n.find("table").css({left:l.offset().left})},f=function(){var t=c();a.height()>l.height()?l.scrollTop()>0?(o.add(r).css({opacity:1,"pointer-events":"auto",position:"fixed",top:l.offset().top-e.scrollTop(),left:l.offset().left}),o.find("table").css({left:-l.scrollLeft()})):(o.add(r).css({opacity:0,"pointer-events":"none"}),r.css({position:"absolute",top:0,left:0})):e.scrollTop()>a.offset().top&&e.scrollTop()<a.offset().top+a.outerHeight()-t?(o.add(r).css({opacity:1,"pointer-events":"auto",position:"fixed",left:l.offset().left}),o.find("table").css({left:-l.scrollLeft()})):o.add(r).css({opacity:0,"pointer-events":"none",position:"absolute",left:0}),l.scrollLeft()>0?n.css({position:"fixed",left:l.offset().left,top:l.offset().top-e.scrollTop(),height:l.height()}).find("table").css({top:-l.scrollTop(),left:0}).end().add(r).css({opacity:1,"pointer-events":"auto"}):n.css({opacity:0,"pointer-events":"none"})},c=function(){var i=0,d=[];return a.find("tbody tr:lt("+s.threshold.rows+")").each(function(){i+=t(this).height()}),d.push(i),d.push(e.height()*s.threshold.viewport),s.threshold.px&&d.push(s.threshold.px),"min"==s.threshold.allowanceEval?Math.min.apply(null,d):Math.max.apply(null,d)};h(),a.parent(".sticky-wrap").scroll(t.throttle(s.scrollThrottle,f)),e.on("load",h).resize(t.debounce(s.resizeThrottle,function(){h(),f()})).scroll(t.throttle(s.scrollThrottle,f)),(s.sortable||null!=a.data("sortable")||a.hasClass("sortable"))&&(a.find("tbody tr").each(function(e){t(this).attr("data-sortOrder",e)}),l.addClass("sortable").find("thead th").addClass("sort-default").data("sortState",1).wrapInner("<div />").find("div").css({position:"relative"}).append('<a href="#" class="sort-handle"></a>').find(".sort-handle").click(function(t){t.preventDefault()}),l.on("click",".sticky-enabled thead th, .sticky-thead thead th, .sticky-col thead th, .sticky-intersect thead th",function(){var e=t(this),s=e.index(),i=l.find("thead th").eq(s),d=t.makeArray(a.find("tbody tr"));e.data("sortState")%3==0?(d.sort(function(e,s){return parseInt(t(e).attr("data-sortOrder"))-parseInt(t(s).attr("data-sortOrder"))}),e.add(i).removeClass().addClass("sort-default")):(d.sort(function(e,a){var i=o(t(e).children().eq(s).text()),d=o(t(a).children().eq(s).text());function o(t){for(var e,s,a=[],i=0,d=-1,o=0;e=(s=t.charAt(i++)).charCodeAt(0);){var n=46==e||e>=48&&e<=57;n!==o&&(a[++d]="",o=n),a[d]+=s}return a}for(x=0;i[x]&&d[x];x++)if(i[x]!==d[x]){var n=Number(i[x]),r=Number(d[x]);return n==i[x]&&r==d[x]?n-r:i[x]>d[x]?1:-1}return i.length-d.length}),e.data("sortState")%3==2?(d=d.reverse(),e.add(i).removeClass().addClass("sort-desc")):e.add(i).removeClass().addClass("sort-asc"));var o=e.data("sortState")+1;e.add(i).data("sortState",o%3),l.find("table").each(function(e){t(this).find("thead th").not(":eq("+s+")").data("sortState",1).removeClass().addClass("sort-default")}),a.find("tbody").html(d),a.find("tbody tr").each(function(e){n.find("tbody tr").eq(e).find("th").html(t(this).find("th").first().html())})}))}}),this}}(jQuery);